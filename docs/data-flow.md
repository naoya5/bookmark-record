- `app/page.tsx` (サーバーコンポーネント):

  - ユーザーがページにアクセスすると、まずサーバー上でこのコンポーネン
    トが実行されます。
  - getInitialTopics 関数が直接データベース（Prisma）にアクセスし、トピ
    ックの一覧を事前に取得します。
  - 取得したトピックのデータ (initialTopics)
    は、クライアント側で動作する BookmarkManagerClient
    コンポーネントにプロパティとして渡されます。
  - これにより、ブラウザは最初からトピック一覧が描画された HTML を受け取
    るため、ページの初期表示が高速になります。

- `components/bookmark-manager-client.tsx` (クライアントコンポーネント):
  - "use client"
    ディレクティブにより、このコンポーネントはブラウザ上で動作します。
  - サーバーから渡された initialTopics を使って useTopics
    フックを初期化します。その後、useSWR がバックグラウンドで API
    (/api/topics)
    にリクエストを送り、データが最新かを確認・更新します。
  - useTopics フックから得られる selectedTopicId (選択中のトピック ID)
    を useBookmarks フックに渡します。
  - これにより、選択中のトピックが変わるたびに `useBookmarks`
    フックが自動的に再実行され、そのトピックに対応するブックマークを API
    (`/api/bookmarks`) から取得します。
    これがアプリケーションのインタラクティブな部分の核となります。
  - TopicSidebar (トピック一覧) や BookmarkGrid (ブックマーク一覧)
    などの UI コンポーネントは、これらのフックから得られるデータを表示し
    ます。
  - ユーザーが「新規作成」や「編集」ボタンを押すと、対応するモーダルが表
    示され、フォームを送信すると各フック内の handle...
    関数が実行されます。これらの関数が API リクエストを送信し、成功すると
    mutate を呼び出して UI のデータを最新の状態に更新します。

---

データフローの全体像

以上の分析を基に、このアプリケーションのデータの流れを詳細に説明します。

1.  初期表示（サーバーサイド）

    1.  ユーザーがアプリケーションの URL にアクセスします。
    2.  Next.js のサーバーがリクエストを受け取り、app/page.tsx
        を実行します。
    3.  サーバーは直接データベースに接続し、すべてのトピック情報（ブックマ
        ーク数を含む）を取得します。
    4.  取得したトピック情報を initialTopics プロパティとして
        BookmarkManagerClient
        コンポーネントに渡し、ページの HTML を生成してブラウザに送信します。

2.  画面表示と初期データ取得（クライアントサイド）

    1.  ブラウザはサーバーから受け取った HTML を表示します。ユーザーはすぐに
        トピックの一覧を見ることができます。
    2.  同時に JavaScript が読み込まれ、BookmarkManagerClient
        コンポーネントがインタラクティブになります（ハイドレーション）。
    3.  useTopics フックが initialTopics を初期データとして使いつつ、useSWR
        の機能で API (/api/topics) にアクセスしてデータが最新かを確認します。

    4.  デフォルトで最初のトピックが選択され、その ID (selectedTopicId) が
        useBookmarks フックに渡されます。
    5.  useBookmarks フックは受け取った ID を使い、API
        (/api/bookmarks?topicId=...) にリクエストを送信して、選択されたトピ
        ックに属するブックマークの一覧を取得します。
    6.  取得したデータが画面に描画され、ユーザーは選択中のトピックとそのブ
        ックマークを見ることができます。

3.  ユーザー操作（例：ブックマークの追加）
    1.  ユーザーが「新しいブックマーク」ボタンをクリックします。
    2.  ブックマーク作成用のモーダル（ダイアログ）が表示されます。
    3.  ユーザーが URL などを入力して「保存」ボタンを押します。
    4.  useBookmarks フック内の handleCreateBookmark 関数が実行されます。
    5.  この関数は、入力されたデータと共に POST リクエストを /api/bookmarks
        へ送信します。
    6.  サーバー側の API はリクエストを受け取り、Prisma を使ってデータベースに
        新しいブックマークを保存します。
    7.  リクエストが成功すると、クライアント側では useSWR の mutate
        関数が呼び出されます。
    8.  mutate
        がトリガーとなり、以下の 2 つのデータが API 経由で再取得されます。
        - ブックマーク一覧: 新しく追加されたブックマークを反映するため。
        - トピック一覧:
          サイドバーに表示されているブックマーク数を更新するため。
    9.  データが更新されると、画面が自動的に再描画され、ユーザーは追加した
        ブックマークと更新されたブックマーク数を確認できます。

このように、このアプリケーションは Next.js のサーバーコンポーネントによる
初期表示の高速化と、クライアントサイドでの SWR
を活用した効率的なデータ取得・状態管理を組み合わせることで、高速かつ応答
性の高いユーザー体験を実現しています。
